@{
    ViewBag.Title = "Home Page";
}

<br />
<div class="row">
    <div id="status" class="col-lg-2" style="display:none">
        <span class="alert alert-success">Kinect-01 online</span>
    </div>
    <div id="alert" class="col-lg-2" style="display:none">
        <span class="alert alert-danger">PROXIMITY ALERT!</span>
    </div>
</div>

@section scripts{
<!--Script references. -->

<!--Reference the SignalR library. -->
<script src="Scripts/jquery.signalR-2.1.2.min.js"></script>
<!--Reference the autogenerated SignalR hub script. -->
<script src="http://localhost:7770/signalr/hubs"></script>
<!--Add script to update the page and send messages.-->
<script type="text/javascript">
    $(document).ready(function () {
        var deferred;

        // Declare a proxy to reference the hub.
        var alerts = $.connection.alertsHub;

        // Create a function that the hub can call to broadcast messages.
        alerts.client.alertReceived = function (event) {
            var alert = $("#alert");
            if (deferred && !deferred.state() == "resolved") {
                deferred.reject();
            }
            else {
                alert.fadeIn();
            }

            deferred = $.Deferred();
            deferred.done(function () {
                alert.fadeOut();
            })
            
            setTimeout(function () {
                deferred.resolve();
            }, 2000)
        };

        alerts.client.onlineNotificationReceived = function (deviceId) {
            $("#status").fadeIn();
        }

        alerts.client.offlineNotificationReceived = function (deviceId) {
            $("#status").fadeOut();
        }
            
        // Start the connection.
        $.connection.hub.url = "http://localhost:7770/signalr";
        $.connection.hub.start().fail(function (error) { alert("error"); });
    });
</script>
}