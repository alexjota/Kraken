@{
    ViewBag.Title = "Home Page";
}

<br />
<div id="container">
    
</div>

@section scripts{
<!--Script references. -->

<!--Reference the SignalR library. -->
<script src="Scripts/jquery.signalR-2.1.2.min.js"></script>
<!--Reference the autogenerated SignalR hub script. -->
<script src="http://localhost:7770/signalr/hubs"></script>
<!--Add script to update the page and send messages.-->
<script type="text/javascript">
    $(document).ready(function () {
        var deferred;

        // Declare a proxy to reference the hub.
        var alerts = $.connection.alertsHub;

        // Create a function that the hub can call to broadcast messages.
        alerts.client.alertReceived = function (event) {
            var alert = $("#alert-" + event.DeviceId);
            if (deferred && !deferred.state() == "resolved") {
                deferred.reject();
            }
            else {
                alert.fadeIn();
            }

            deferred = $.Deferred();
            deferred.done(function () {
                alert.fadeOut();
            })
            
            setTimeout(function () {
                deferred.resolve();
            }, 2000)
        };

        alerts.client.onlineNotificationReceived = function (deviceId) {
            var html = "<div id='" + deviceId + "' class='row'>" +
                            "<div id='status-" + deviceId + "' class='col-lg-2' style='display:none'>" +
                                "<span class='alert alert-success'>Kinect-01 online</span>" +
                            "</div>" +
                            "<div id='alert-" + deviceId + "' class='col-lg-2' style='display:none'>" +
                                "<span class='alert alert-danger'>PROXIMITY ALERT!</span>" +
                            "</div>" +
                        "</div>";

            $("#container").append(html);
            $("#status-"+deviceId).fadeIn();
        }

        alerts.client.offlineNotificationReceived = function (deviceId) {
            $("#status-" + deviceId).fadeOut();
            $("#" + deviceId).remove();
        }
            
        // Start the connection.
        $.connection.hub.url = "http://localhost:7770/signalr";
        $.connection.hub.start().fail(function (error) { alert("error"); });
    });
</script>
}